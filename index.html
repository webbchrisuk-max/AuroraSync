<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Monzo Aurora v2 – Live Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet" />

<style>
/* === Base === */
body{
  margin:0;
  font-family:"Orbitron",sans-serif;
  color:#fff;
  background:radial-gradient(circle at top right,#05010f 0%,#0d0320 70%);
  background-size:200% 200%;
  animation:alivePulse 16s ease-in-out infinite alternate;
  overflow-x:hidden;
}
@keyframes alivePulse{
  0%{background:radial-gradient(circle at top right,#05010f 0%,#0d0320 70%);}
  100%{background:radial-gradient(circle at bottom left,#150038 0%,#000010 80%);}
}

h1{text-align:center;color:#4de0ff;text-shadow:0 0 15px #4de0ff;margin:25px 0 10px;}
.status{text-align:center;font-size:.9rem;margin-bottom:10px;}
.status.ok{color:#00ffcc;}
.status.error{color:#ff3366;}

/* === Layout Grid === */
.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(350px,1fr));
  gap:20px;
  max-width:1100px;
  margin:0 auto;
  padding:0 20px 30px;
}
section{
  background:rgba(20,20,40,0.4);
  border:1px solid rgba(0,255,255,0.2);
  border-radius:12px;
  padding:20px;
  box-shadow:0 0 20px rgba(0,255,255,0.15);
}
h2{
  color:#4de0ff;
  text-shadow:0 0 10px #4de0ff;
  margin:0 0 15px;
  position:relative;
}
h2::after{
  content:"";
  position:absolute;
  left:0;
  bottom:-3px;
  width:100%;
  height:2px;
  background:linear-gradient(90deg,#00c6ff,#ff2e63);
  animation:glowLine 2.5s ease-in-out infinite alternate;
}
@keyframes glowLine{
  0%{opacity:.6;filter:blur(1px);}
  100%{opacity:1;filter:blur(3px);}
}

/* === Progress Bars === */
.progress{
  height:10px;
  background:rgba(255,255,255,0.08);
  border-radius:6px;
  overflow:hidden;
  margin:8px 0 14px;
  box-shadow:0 0 8px rgba(0,255,255,0.2) inset;
  position:relative;
}
.progress span{
  display:block;
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#00c6ff,#ff2e63);
  box-shadow:0 0 20px #00c6ff,0 0 30px #ff2e63;
  border-radius:6px;
  animation:fillBar 2s ease-out forwards,pulseGlow 3s infinite alternate;
}
@keyframes fillBar{
  from{width:0%;}
  to{width:var(--width,100%);}
}
@keyframes pulseGlow{
  0%{filter:brightness(1);}
  100%{filter:brightness(1.5);}
}

/* === Footer === */
footer{
  text-align:center;
  color:#4de0ff;
  font-size:.9rem;
  margin:20px 0 30px;
}
button{
  background:none;
  border:1px solid #4de0ff;
  color:#4de0ff;
  padding:6px 14px;
  border-radius:8px;
  cursor:pointer;
  font-family:"Orbitron",sans-serif;
  margin-top:8px;
}
button:hover{background:#4de0ff;color:#000;}
</style>
</head>

<body>
<h1>Monzo Aurora v2 – Live Dashboard</h1>
<div id="status" class="status">🔄 Checking connection...</div>

<div class="dashboard">
  <section id="main">
    <h2>Main Account</h2>
    <div id="mainContent">Loading...</div>
    <div id="transactions">
      <h2>Recent Transactions</h2>
      <div id="transactionsContent">Loading...</div>
      <button id="toggleTx" onclick="toggleTx()">Show More</button>
    </div>
  </section>

  <section id="pots">
    <h2>Pots Overview</h2>
    <div id="potsContent">Loading pots...</div>
  </section>

  <section id="directdebits">
    <h2>Upcoming Direct Debits</h2>
    <div id="ddContent">Loading...</div>
    <button id="toggleDD" onclick="toggleDD()">Show More</button>
  </section>
</div>

<footer id="summary">Loading summary...</footer>

<script>
const jsonURL="https://webbchrisuk-max.github.io/AuroraSync/Monzo_Aurora.json";
const statusEl=document.getElementById("status");
let txExpanded=false,ddExpanded=false;

async function loadAurora(){
 try{
   const res=await fetch(jsonURL+"?nocache="+Date.now(),{cache:"no-store"});
   if(!res.ok)throw new Error(res.status);
   const data=await res.json();
   statusEl.textContent="🟢 Live JSON Loaded (Balances + Pots)";
   statusEl.className="status ok";
   renderMain(data);
   renderPots(data.pots);
   renderDirectDebits(data.pots["Direct Debits"]);
   renderSummary(data);
 }catch(e){
   console.error("❌ Fetch error:",e);
   statusEl.textContent="🔴 Unable to load live data.";
   statusEl.className="status error";
 }
}

function renderMain(d){
 const el=document.getElementById("mainContent");
 const saved=(d.weekly_allowance-10.98).toFixed(2);
 el.innerHTML=`
  <h3 style="font-size:2em;color:#fff;">£${d.main_balance.toFixed(2)}</h3>
  <p>
   Flex Balance: £${d.flex_balance.toFixed(2)}<br>
   Weekly Allowance: £${d.weekly_allowance.toFixed(2)}<br>
   Daily Allowance: £${d.daily_allowance.toFixed(2)}<br>
   Next Payday: ${d.next_payday}<br>
   Saved vs Allowed: £${saved} / £${d.weekly_allowance.toFixed(2)}
  </p>`;
 renderTransactions();
}

function renderTransactions(){
 const tx=[
   {date:"28 Oct",merchant:"400",amount:2.99},
   {date:"28 Oct",merchant:"Nic Services Group",amount:0.70},
   {date:"27 Oct",merchant:"400",amount:2.99},
   {date:"27 Oct",merchant:"Nic Services Group",amount:1.10},
   {date:"25 Oct",merchant:"Cbs Arena Kiosk 10",amount:8.10}
 ];
 const el=document.getElementById("transactionsContent");
 const show=txExpanded?tx:tx.slice(0,5);
 el.innerHTML=show.map(t=>`
  <div>${t.date} – ${t.merchant}
   <span style="float:right;">£${t.amount.toFixed(2)}</span>
  </div>`).join("");
}

function toggleTx(){
 txExpanded=!txExpanded;
 document.getElementById("toggleTx").textContent=txExpanded?"Show Less":"Show More";
 renderTransactions();
}

function renderPots(pots){
 const el=document.getElementById("potsContent");
 el.innerHTML="";
 for(const [name,pot] of Object.entries(pots)){
   if(name==="Direct Debits")continue;
   const pct=pot.target>0?(pot.current/pot.target)*100:0;
   el.innerHTML+=`
     <div><strong>${name}</strong>
     £${pot.current.toFixed(2)} / £${pot.target.toFixed(2)}
     <div class="progress" style="--width:${pct}%"><span></span></div>
     </div>`;
 }
}

function renderDirectDebits(dd){
 const el=document.getElementById("ddContent");
 if(!dd||!dd.items){el.textContent="No data.";return;}
 const list=dd.items;
 const show=ddExpanded?list:list.slice(0,5);
 el.innerHTML=show.map(i=>`
  <div>${i.date} – ${i.name}
   <span style="float:right;">£${i.amount.toFixed(2)}</span>
  </div>`).join("");
}
function toggleDD(){
 ddExpanded=!ddExpanded;
 document.getElementById("toggleDD").textContent=ddExpanded?"Show Less":"Show More";
 const dataFetched=document.getElementById("ddContent").innerHTML;
 if(dataFetched)loadAurora(); // reload to re-render with toggle
}

function renderSummary(d){
 const remain=(d.daily_allowance-10.98).toFixed(2);
 document.getElementById("summary").innerHTML=
  `Today’s allowance £${d.daily_allowance.toFixed(2)} · 
   Spent £10.98 (Work) · Remaining £${remain} · 
   Round-ups £7.10 → IG Trading · 
   Suggested Work Buffer → Main £10.98`;
}
<!-- === Rollover Summary Card === -->
<div id="rolloverCard" class="rollover-card" style="display:none;">
  <h3>Weekly Rollover Summary</h3>
  <p id="rolloverMessage">£0.00 underspent this week → moved to Holding Pot 💰</p>
</div>

loadAurora();
</script>
</body>
</html>